{% assign current_dir = page.dir %}

{%- assign items = '' -%}
{%- for p in site.pages -%}
  {%- if p.name == 'index.md' and p.dir != current_dir and p.dir contains current_dir -%}
    {%- assign rest = p.dir | remove_first: current_dir -%}
    {%- assign parts = rest | split: '/' -%}
    {%- if parts.size == 2 and parts[1] == '' -%}
      {%- capture items -%}{{ items }}<li><a href="{{ p.url }}">{{ p.title | default: p.name | remove: '.md' }}</a></li>{%- endcapture -%}
    {%- endif -%}
  {%- endif -%}
{%- endfor -%}

{%- if items != '' -%}
<ul>
  {{ items }}
</ul>
{%- else -%}
<ul>
  {%- for p in site.pages -%}
    {%- if p.dir == current_dir and p.name != 'index.md' -%}
      <li><a href="{{ p.url }}">{{ p.title | default: p.name | remove: '.md' }}</a></li>
    {%- endif -%}
  {%- endfor -%}
</ul>
{%- endif -%} 